<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake</title>
  </head>
  <body>
    <canvas id="game-field" width="500" height="500"></canvas>
  </body>
  <script>
    const screen = document.getElementById("game-field");

    const rows = 20;
    const cols = 20;

    //const gameGrid = Array.from(Array(rows), () => new Array(cols).fill(0));

    let snake = [
      [6, 0],
      [5, 0],
      [4, 0],
      [3, 0],
      [2, 0],
      [1, 0],
      [0, 0],
    ];

    // TODO Fruit generator

    // TODO Score counter

    function cycleGame(direction) {
      // TODO Collision detection (self and edges)
      // TODO Fruit pickup detection
      // TODO Refactor to stop mutation of snake array
      // Maybe add sped up replay behind game over screen
      let headLastPos = snake[0].concat();

      snake.pop();
      snake.unshift([
        (headLastPos[0] += direction[0]),
        (headLastPos[1] += direction[1]),
      ]);

      return snake;
    }

    function handleInput({ code }) {
      switch (code) {
        case "KeyW":
        case "ArrowUp":
          console.log("going up");
          cycleGame([0, -1]);
          break;
        case "KeyD":
        case "ArrowRight":
          console.log("going right");
          cycleGame([1, -0]);
          break;
        case "KeyS":
        case "ArrowDown":
          console.log("going down");
          cycleGame([0, 1]);
          break;
        case "KeyA":
        case "ArrowLeft":
          console.log("going left");
          cycleGame([-1, 0]);
          break;
      }
    }

    function draw(snakeGrid, fruitPos) {
      if (screen.getContext) {
        const ctx = screen.getContext("2d");

        const tileWidth = screen.offsetWidth / cols;
        const tileHeight = screen.offsetHeight / rows;

        for (let x = 0; x < rows; x++) {
          for (let y = 0; y < cols; y++) {
            ctx.fillStyle = snakeGrid[x][y] === 1 ? "white" : "grey";
            ctx.fillRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);
          }
        }
      }
    }

    draw(snakeGrid);

    //window.setInterval(() => draw(), 50);
  </script>
  <style>
    body {
      height: 100vh;
      width: 100vw;
      margin: 0;
      background: #000;
    }
    #game-field {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      margin: auto;
      background: #222;
    }
  </style>
</html>
